<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amir's Information Aggregator v1.4</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        #feed-list { list-style-type: none; padding: 0; }
        .feed-item { border-bottom: 1px solid #ccc; padding: 10px 0; }
        .feed-item button { margin-left: 10px; }
        .hidden { display: none; }
        #feed-summary, #excluded-terms { margin-top: 20px; }
        #error-message { color: red; }
        .section { margin-top: 30px; border-top: 1px solid #ccc; padding-top: 20px; }
        .subsection { margin-top: 20px; }
        .form-group { margin-bottom: 15px; }
        button { margin-right: 10px; }
        h3 { margin-bottom: 10px; }
        #feed-builder h2 { color: darkblue; }
        .boxed-section {
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            padding: 15px;
            margin-top: 20px;
        }
        .boxed-section h3 {
            margin-top: 0;
        }
        .boxed-section button {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Amir's Information Aggregator v1.4</h1>
    <div id="error-message"></div>
    <ul id="feed-list"></ul>

    <div id="feed-builder" class="section">
        <h2>Feed Builder</h2>
        
        <div class="subsection">
            <h3>News Search</h3>
            <div class="form-group">
                <label>
                    <input type="radio" name="search-engine" value="google" checked> Google News
                </label>
                <label>
                    <input type="radio" name="search-engine" value="bing"> Bing News
                </label>
            </div>
            <div class="form-group">
                <input type="text" id="keywords" placeholder="Enter keywords">
                <button onclick="generateFeed()">Generate Feed</button>
            </div>
            <div id="generated-feed"></div>
        </div>

        <div class="subsection">
            <h3>Enter your own feed</h3>
            <div class="form-group">
                <input type="text" id="new-feed" placeholder="Enter RSS feed URL">
                <button onclick="addFeed()">Add Feed</button>
            </div>
        </div>

        <div class="subsection">
            <h3>Exclude Terms</h3>
            <div class="form-group">
                <input type="text" id="exclude-term" placeholder="Enter term to exclude">
                <button onclick="addExcludedTerm()">Add Excluded Term</button>
            </div>
        </div>

        <div class="boxed-section">
            <div id="excluded-terms"></div>
        </div>

        <div class="boxed-section">
            <div id="feed-summary"></div>
        </div>
    </div>

   <script>
    let feeds = [];
    const excludedTerms = new Set();

    function loadFeeds() {
        const storedFeeds = localStorage.getItem('feeds');
        if (storedFeeds) {
            feeds = JSON.parse(storedFeeds);
        }
        updateFeedList();
        updateFeedSummary();
        fetchAllFeeds();
    }

    function saveFeed() {
        localStorage.setItem('feeds', JSON.stringify(feeds));
    }

    function addFeed() {
        const newFeed = document.getElementById('new-feed').value.trim();
        if (newFeed && !feeds.includes(newFeed)) {
            feeds.push(newFeed);
            saveFeed();
            updateFeedList();
            updateFeedSummary();
            fetchFeed(newFeed);
            document.getElementById('new-feed').value = '';
        }
    }

    function removeFeed(index) {
        feeds.splice(index, 1);
        saveFeed();
        updateFeedList();
        updateFeedSummary();
        fetchAllFeeds();
    }

    function clearAllFeeds() {
        feeds = [];
        saveFeed();
        updateFeedList();
        updateFeedSummary();
        document.getElementById('feed-list').innerHTML = '';
    }

    function updateFeedList() {
        const feedList = document.getElementById('feed-list');
        feedList.innerHTML = '';
        feeds.forEach((feed, index) => {
            const li = document.createElement('li');
            li.className = 'feed-item';
            li.innerHTML = `
                ${feed}
                <button onclick="removeFeed(${index})">Remove</button>
            `;
            feedList.appendChild(li);
        });
    }

    function generateFeed() {
        const keywords = document.getElementById('keywords').value.trim();
        const searchEngine = document.querySelector('input[name="search-engine"]:checked').value;
        
        if (keywords) {
            let feedUrl;
            if (searchEngine === 'google') {
                feedUrl = `https://news.google.com/rss/search?q=${encodeURIComponent(keywords)}&hl=en-US&gl=US&ceid=US:en`;
            } else {
                feedUrl = `https://www.bing.com/news/search?q=${encodeURIComponent(keywords)}&format=rss`;
            }
            
            document.getElementById('generated-feed').innerHTML = `
                Generated feed URL: ${feedUrl}
                <button onclick="addGeneratedFeed('${feedUrl}')">Add to feeds</button>
            `;
        }
    }

    function addGeneratedFeed(feedUrl) {
        if (!feeds.includes(feedUrl)) {
            feeds.push(feedUrl);
            saveFeed();
            updateFeedList();
            updateFeedSummary();
            fetchFeed(feedUrl);
        }
    }

    function addExcludedTerm() {
        const term = document.getElementById('exclude-term').value.trim().toLowerCase();
        if (term && !excludedTerms.has(term)) {
            excludedTerms.add(term);
            updateExcludedTerms();
            document.getElementById('exclude-term').value = '';
            fetchAllFeeds();
        }
    }

    function removeExcludedTerm(term) {
        excludedTerms.delete(term);
        updateExcludedTerms();
        fetchAllFeeds();
    }

    function clearAllExclusions() {
        excludedTerms.clear();
        updateExcludedTerms();
        fetchAllFeeds();
    }

    function updateFeedSummary() {
        const summary = document.getElementById('feed-summary');
        summary.innerHTML = '<h3>Current Feeds:</h3>';
        if (feeds.length === 0) {
            summary.innerHTML += '<p>No feeds added yet.</p>';
        } else {
            const ul = document.createElement('ul');
            feeds.forEach((feed, index) => {
                const li = document.createElement('li');
                li.textContent = feed;
                const removeButton = document.createElement('button');
                removeButton.textContent = 'Remove';
                removeButton.onclick = () => removeFeed(index);
                li.appendChild(removeButton);
                ul.appendChild(li);
            });
            summary.appendChild(ul);
        }
        const clearButton = document.createElement('button');
        clearButton.textContent = 'Clear All Feeds';
        clearButton.onclick = clearAllFeeds;
        summary.appendChild(clearButton);
    }

    function updateExcludedTerms() {
        const excludedTermsDiv = document.getElementById('excluded-terms');
        excludedTermsDiv.innerHTML = '<h3>Excluded Terms:</h3>';
        if (excludedTerms.size === 0) {
            excludedTermsDiv.innerHTML += '<p>No terms excluded.</p>';
        } else {
            const ul = document.createElement('ul');
            excludedTerms.forEach(term => {
                const li = document.createElement('li');
                li.textContent = term;
                const removeButton = document.createElement('button');
                removeButton.textContent = 'Remove';
                removeButton.onclick = () => removeExcludedTerm(term);
                li.appendChild(removeButton);
                ul.appendChild(li);
            });
            excludedTermsDiv.appendChild(ul);
        }
        const clearButton = document.createElement('button');
        clearButton.textContent = 'Clear All Exclusions';
        clearButton.onclick = clearAllExclusions;
        excludedTermsDiv.appendChild(clearButton);
    }

    function fetchAllFeeds() {
        document.getElementById('feed-list').innerHTML = '';
        feeds.forEach(feed => fetchFeed(feed));
    }

    function fetchFeed(feedUrl) {
        const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feedUrl)}`;
        
        fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                if (data.status === 'ok') {
                    displayFeedItems(data.items, feedUrl);
                } else {
                    console.error('Error fetching feed:', data.message);
                }
            })
            .catch(error => console.error('Error:', error));
    }

    function displayFeedItems(items, feedUrl) {
        const feedList = document.getElementById('feed-list');
        
        items.forEach(item => {
            if (!isExcluded(item.title)) {
                const li = document.createElement('li');
                li.className = 'feed-item';
                li.innerHTML = `
                    <h3><a href="${item.link}" target="_blank">${item.title}</a></h3>
                    <p>${item.description}</p>
                    <small>Published: ${moment(item.pubDate).format('MMMM D, YYYY h:mm A')} | Source: ${feedUrl}</small>
                `;
                feedList.appendChild(li);
            }
        });
    }

    function isExcluded(title) {
        const lowerTitle = title.toLowerCase();
        return Array.from(excludedTerms).some(term => lowerTitle.includes(term));
    }

    // Load feeds on page load
    loadFeeds();
</script>
</body>
</html>
